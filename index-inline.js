const lang="english",max_price_in_cents=700,tz="Europe/Moscow";let teacherList,xhr=new XMLHttpRequest,teacherObject={id:0,url:"",name:"",price:"",avatar:"",greetVideo:"",originCountryId:""},accumTeacherList=[],page=1;function getTeacherList(a){return new Promise((b,c)=>{xhr.open("POST","https://api.italki.com/api/v2/teachers"),xhr.setRequestHeader("accept","application/json, text/plain, */*"),xhr.setRequestHeader("accept-language","en-us"),xhr.setRequestHeader("content-type","application/json"),xhr.setRequestHeader("x-browser-key","c795cc47-b029-4bd2-bb4e-1cc4478e1abd"),xhr.setRequestHeader("x-device","10"),xhr.setRequestHeader("x-front-ver","2.2.0"),xhr.send(JSON.stringify({teach_language:{language:lang,max_price:max_price_in_cents,is_native:1},page:a,page_size:50,user_timezone:tz})),xhr.onreadystatechange=async function(){4==this.readyState&&(200==this.status?(teacherList=JSON.parse(this.responseText),teacherList.data.forEach(a=>{let b=Object.create(teacherObject);b.id=a.user_info.user_id,b.url="https://www.italki.com/teacher/"+a.user_info.user_id,b.name=a.user_info.nickname,b.originCountryId=a.user_info.origin_country_id,b.avatar=a.teacher_info.qiniu_video_pic_url,b.greetVideo=a.teacher_info.qiniu_video_url,accumTeacherList.push(b)}),a++,1===teacherList.paging.has_next&&10>a&&(await getTeacherList(a)),b(!0)):c())}})}function getLowestPrice(a){return new Promise((b,c)=>{xhr.open("GET","https://api.italki.com/api/v2/teacher/"+a.id+"/course"),xhr.send(),xhr.onreadystatechange=function(){var d=Math.min;if(4==this.readyState)if(200==this.status){let c=[];JSON.parse(this.responseText).data.pro_course_detail.forEach(a=>{a.price_list.forEach(a=>c.push(a.session_price))}),a.price=d(...c),b(a)}else c()}})}async function main(){document.getElementsByTagName("body")[0].innerHTML="<div id='loading' style='position: absolute;top: 10em;width: 120px;height: 120px;left: calc(50% - 50px);background: url(https://acegif.com/wp-content/uploads/loading-25.gif);background-size: 120px 120px;z-index: 100;'></div>";let a="<tr><td><h3>Price</h3></td><td><h3>Name</h3></td><td></td><td><h3>Country</h3></td><td><h3>Greeting video</h3></td><td><h3>Link</h3></td></tr>";await getTeacherList(1);for(let a=0;a<accumTeacherList.length;a++)accumTeacherList[a]=await getLowestPrice(accumTeacherList[a]);accumTeacherList.sort(function(a,b){return a.price<b.price?-1:a.price>b.price?1:0}),accumTeacherList.forEach(b=>{a=a+"<tr><td><h1>"+b.price/100+" $</h1></td><td><h1>"+b.name+"</h1></td><td>"+b.originCountryId+"</td><td><img src=\"https://scdn.italki.com/orion/static/flags/"+b.originCountryId.toLowerCase()+".svg\" class=\"ant-avatar\" /></td><td><video controls width=\"360px\" height=\"200px\"><source src=\""+b.greetVideo+"\" type=\"video/mp4\" /></video></td><td><a href=\""+b.url+"\">Personal page</a></td></tr>"}),document.getElementsByTagName("body")[0].innerHTML="<center><h1>Teacher list sort by price</h1></center><table>"+a+"</table>"}main();