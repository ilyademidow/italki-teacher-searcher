const lang="english",max_price_in_cents=700,tz="Europe/Moscow";let xhr=new XMLHttpRequest,teacherObject={id:0,url:"",name:"",price:"",avatar:"",greetVideo:"",originCountryId:""},accumTeacherList=[],teacherList,page=1;function getTeacherList(r){return new Promise((e,t)=>{xhr.open("POST","https://api.italki.com/api/v2/teachers"),xhr.setRequestHeader("accept","application/json, text/plain, */*"),xhr.setRequestHeader("accept-language","en-us"),xhr.setRequestHeader("content-type","application/json"),xhr.setRequestHeader("x-browser-key","c795cc47-b029-4bd2-bb4e-1cc4478e1abd"),xhr.setRequestHeader("x-device","10"),xhr.setRequestHeader("x-front-ver","2.2.0"),xhr.send(JSON.stringify({teach_language:{language:lang,max_price:max_price_in_cents,is_native:1},page:r,page_size:50,user_timezone:tz})),xhr.onreadystatechange=async function(){4==this.readyState&&(200==this.status?(teacherList=JSON.parse(this.responseText),teacherList.data.forEach(e=>{let t=Object.create(teacherObject);t.id=e.user_info.user_id,t.url="https://www.italki.com/teacher/"+e.user_info.user_id,t.name=e.user_info.nickname,t.originCountryId=e.user_info.origin_country_id,t.avatar=e.teacher_info.qiniu_video_pic_url,t.greetVideo=e.teacher_info.qiniu_video_url,accumTeacherList.push(t)}),r++,1===teacherList.paging.has_next&&r<10&&await getTeacherList(r),e(!0)):t())}})}function getLowestPrice(r){return new Promise((e,t)=>{xhr.open("GET","https://api.italki.com/api/v2/teacher/"+r.id+"/course"),xhr.send(),xhr.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){let t=[];JSON.parse(this.responseText).data.pro_course_detail.forEach(e=>{e.price_list.forEach(e=>t.push(e.session_price))}),r.price=Math.min(...t),e(r)}else t()}})}async function main(){let t="<tr><td><h3>Price</h3></td><td><h3>Name</h3></td><td></td><td><h3>Country</h3></td><td><h3>Greeting video</h3></td><td><h3>Link</h3></td></tr>";await getTeacherList(1);for(let e=0;e<accumTeacherList.length;e++)accumTeacherList[e]=await getLowestPrice(accumTeacherList[e]);accumTeacherList.sort(function(e,t){return e.price<t.price?-1:e.price>t.price?1:0}),accumTeacherList.forEach(e=>{t=t+"<tr><td><h1>"+e.price/100+" $</h1></td><td><h1>"+e.name+"</h1></td><td>"+e.originCountryId+'</td><td><img src="https://scdn.italki.com/orion/static/flags/'+e.originCountryId.toLowerCase()+'.svg" class="ant-avatar" /></td><td><video controls width="360px" height="200px"><source src="'+e.greetVideo+'" type="video/mp4" /></video></td><td><a href="'+e.url+'">Personal page</a></td></tr>'}),document.getElementsByTagName("body")[0].innerHTML="<center><h1>Teacher list sort by price</h1></center><table>"+t+"</table>"}main();
